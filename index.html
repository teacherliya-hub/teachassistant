<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智慧課堂助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
   
    <style type="text/tailwindcss">
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* sky-50 */
            transition: background-color 0.3s; 
        }

        #student-list-container::-webkit-scrollbar,
        #class-management-list::-webkit-scrollbar,
        #unseated-students-list::-webkit-scrollbar {
            width: 8px;
        }
        #student-list-container::-webkit-scrollbar-thumb,
        #class-management-list::-webkit-scrollbar-thumb,
        #unseated-students-list::-webkit-scrollbar-thumb {
            background-color: #bae6fd; /* sky-200 */
            border-radius: 4px;
        }
        #draw-result { transition: all 0.1s ease-in-out; min-height: 100px; display: flex; align-items: center; justify-content: center; }
        .timer-display-stopwatch { font-size: 3rem; font-weight: 700; color: #78350f; letter-spacing: 2px; margin: 10px 0; min-width: 150px; text-align: center; }
        .timer-display-countdown { font-size: 3rem; font-weight: 700; color: #881337; letter-spacing: 2px; margin: 10px 0; min-width: 150px; text-align: center; }
        .score-btn { @apply p-2 rounded-full shadow-md transition duration-150 ease-in-out hover:shadow-lg focus:outline-none; }
        .editable-content { display: flex; align-items: center; justify-content: start; gap: 4px; }
        .edit-btn { @apply text-gray-400 hover:text-sky-600 p-0.5 rounded transition duration-150; }
        #draw-result-modal-content { transition: all 0.2s ease-out; }
        
        .student-block {
            @apply p-1 border border-teal-400 rounded-md cursor-grab bg-teal-100 text-teal-800 text-lg font-medium flex items-center justify-center text-center shadow;
            min-height: 60px;                                                 
        }
        .student-block.dragging { @apply opacity-50 shadow-lg scale-105; }
        
        .seat {

            @apply border-solid border-2 border-blue-200 rounded-md flex items-center justify-center min-h-[70px] bg-blue-50 p-1;
        }
        .seat.drag-over { @apply border-cyan-400 bg-cyan-100; }
        

        .seat .student-block {
            @apply w-full h-full min-h-[60px];
        }
    </style>
</head>
<body class="bg-sky-50">

    <nav class="bg-sky-700 shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- 
              RWD MODIFIED: 
              - h-16 -> h-auto md:h-16 
              - flex justify-between items-center -> flex flex-col md:flex-row md:justify-between md:items-center 

              - py-3 md:py-0 
            -->
            <div class="flex flex-col md:flex-row md:justify-between md:items-center h-auto md:h-16 py-3 md:py-0">
                <!-- RWD MODIFIED: self-center md:self-auto  -->
                <h1 class="text-xl font-bold text-white self-center md:self-auto">前鎮國中課堂助手</h1>
                <!-- RWD MODIFIED: self-center md:self-auto  | mt-3 md:mt-0  -->
                <div class="flex items-center space-x-4 self-center md:self-auto mt-3 md:mt-0">
                    <button id="toggle-stopwatch-btn" class="p-3 rounded-full hover:bg-sky-600 transition duration-150" title="計時器">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-sky-200 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>
                    <button id="toggle-countdown-btn" class="p-3 rounded-full hover:bg-sky-600 transition duration-150" title="倒數計時">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-sky-200 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 2h12v6l-4 4 4 4v6H6v-6l4-4-4-4V2z" />
                        </svg>
                    </button>
                    <!-- SEATING CHART BUTTON (Icon Updated) -->
                    <button id="toggle-seating-chart-btn" class="p-3 rounded-full hover:bg-sky-600 transition duration-150" title="座位表">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-sky-200 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8 20v-5.333c0-1.473.8-2.667 2-2.667h4c1.2 0 2 1.194 2 2.667V20M8 20h8M8 20l-2 2M16 20l2 2M5 9V7a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v2c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2Z" />
                        </svg>
                    </button>
                    <button id="toggle-management-btn" class="p-3 rounded-full hover:bg-sky-600 transition duration-150" title="班級管理">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-sky-200 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                    <button id="add-class-modal-btn" class="p-3 rounded-full hover:bg-sky-600 transition duration-150" title="新增班級與學生資料">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-sky-200 hover:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <div id="timer-container" class="max-w-7xl mx-auto mt-4 px-4 sm:px-6 lg:px-8">
        <div id="stopwatch-area" class="bg-amber-100 p-4 rounded-lg shadow-md mb-4 hidden flex flex-col items-center justify-center gap-4 md:flex-row md:space-x-4 md:gap-0">
            <span class="timer-display-stopwatch" id="stopwatch-display">00:00</span>
            <div class="flex flex-wrap justify-center gap-2">
                <button id="stopwatch-start-btn" class="px-4 py-2 bg-sky-500 text-white font-semibold rounded-lg hover:bg-sky-600 transition duration-150 shadow-md">開始</button>
                <button id="stopwatch-stop-btn" class="px-4 py-2 bg-slate-500 text-white font-semibold rounded-lg hover:bg-slate-600 transition duration-150 shadow-md">停止</button>
                <button id="stopwatch-reset-btn" class="px-4 py-2 bg-rose-500 text-white font-semibold rounded-lg hover:bg-rose-600 transition duration-150 shadow-md">重設</button>
            </div>
        </div>
        <div id="countdown-area" class="bg-rose-100 p-4 rounded-lg shadow-md mb-4 hidden flex flex-col items-center justify-center gap-4 md:flex-row md:space-x-4 md:gap-0">
            <span class="timer-display-countdown" id="countdown-display">00:00</span>
            <div class="flex flex-wrap items-center justify-center gap-2">
                <input type="number" id="countdown-minutes" placeholder="分" class="w-16 p-2 border border-rose-200 rounded-lg text-center" min="0" max="60">
                <input type="number" id="countdown-seconds" placeholder="秒" class="w-16 p-2 border border-rose-200 rounded-lg text-center" min="0" max="59">
                <button id="countdown-set-btn" class="px-4 py-2 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition duration-150 shadow-md">設定</button>
                <button id="countdown-start-btn" class="px-4 py-2 bg-sky-500 text-white font-semibold rounded-lg hover:bg-sky-600 transition duration-150 shadow-md">開始</button>
                <button id="countdown-stop-btn" class="px-4 py-2 bg-slate-500 text-white font-semibold rounded-lg hover:bg-slate-600 transition duration-150 shadow-md">停止</button>
            </div>
        </div>
    </div>

    <main id="main-content-view" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main content remains the same -->
        <section class="lg:col-span-1 bg-white p-6 rounded-xl shadow-lg border border-sky-200/50">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold text-sky-800">抽籤與數據</h2>
            </div>
            <div class="mb-6">
                <label for="class-select" class="block text-sm font-medium text-slate-700 mb-2">選擇班級：</label>
                <div class="flex space-x-2">
                    <select id="class-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500 transition duration-150 shadow-sm">
                        <option value="" disabled selected>請先新增班級資料</option>
                    </select>
                </div>
            </div>
            <div class="mb-6 border-t pt-4">
                <h3 class="text-xl font-medium text-sky-800 mb-3">隨機點名</h3>
                <div id="draw-result" class="bg-sky-100 border-2 border-sky-200 text-sky-800 font-extrabold text-4xl sm:text-5xl rounded-lg mb-4 py-8 shadow-inner text-center">
                    待選中
                </div>
                <button id="draw-btn" class="w-full px-4 py-3 bg-orange-500 text-white font-bold text-lg rounded-lg hover:bg-orange-600 transition duration-150 shadow-xl focus:outline-none focus:ring-4 focus:ring-orange-300 disabled:bg-orange-300" disabled>
                    擲骰子 (從勾選名單中抽出)
                </button>
                <p id="selection-status" class="text-sm text-slate-500 mt-2 text-center"></p>
            </div>
        </section>

        <section class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-sky-200/50">
            <div id="student-list-area">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-sky-800">學生列表與分數管理</h2>
                </div>
                <div id="student-list-container" class="overflow-y-auto max-h-[70vh] border border-gray-200 rounded-lg shadow-inner">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-slate-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-1/12">
                                    <input type="checkbox" id="select-all-checkbox" onchange="toggleSelectAll(this)" class="h-5 w-5 text-sky-600 border-gray-300 rounded focus:ring-sky-500 cursor-pointer">
                                </th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-2/12">座號</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-4/12">姓名</th>
                                <th class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider w-5/12">分數操作</th>
                            </tr>
                        </thead>
                        <tbody id="student-list-body" class="bg-white divide-y divide-gray-200">
                            <tr><td colspan="4" class="text-center py-8 text-slate-500">請透過右上角的 '+' 按鈕新增班級資料</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="class-management-area" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold text-sky-800">班級管理</h2>
                     <div class="flex space-x-2">
                        <button id="export-data-btn" class="px-4 py-2 bg-slate-500 text-white text-sm font-semibold rounded-lg hover:bg-slate-600 transition">匯出資料</button>
                        <button id="import-data-btn" class="px-4 py-2 bg-slate-500 text-white text-sm font-semibold rounded-lg hover:bg-slate-600 transition">匯入資料</button>
                        <button id="clear-data-btn" class="px-4 py-2 bg-slate-600 text-white text-sm font-semibold rounded-lg hover:bg-slate-700 transition">清除本機儲存</button>
                        <input type="file" id="import-file-input" class="hidden" accept=".json">
                    </div>
                </div>
                <div id="class-management-content" class="space-y-4">
                    </div>
            </div>
        </section>
    </main>

    <!-- SEATING CHART VIEW -->
    <!-- Grid changed to 8 columns for 1:7 ratio -->
    <div id="seating-chart-view" class="hidden max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-8 gap-6">
            <!-- Left Panel: Unseated Students (1 column) -->
            <div class="lg:col-span-1 bg-white p-4 rounded-xl shadow-lg border border-sky-200/50">
                <h2 class="text-xl font-semibold text-sky-800 mb-2 pb-2 border-b">未排座位</h2>
                 <!-- Seating chart class select -->
                <div class="mb-4">
                    <label for="class-select-seating" class="block text-sm font-medium text-slate-700 mb-1">目前班級：</label>
                    <select id="class-select-seating" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500 transition duration-150 shadow-sm">
                        <option value="" disabled selected>請先新增班級資料</option>
                    </select>
                </div>
                <div id="unseated-students-list" class="space-y-2 h-[65vh] overflow-y-auto pr-2">
                    <!-- Student blocks will be dynamically inserted here -->
                </div>
            </div>
            <!-- Right Panel: Classroom Layout (7 columns) -->
            <div class="lg:col-span-7 bg-white p-4 rounded-xl shadow-lg border border-sky-200/50">
                 <!-- Controls -->
                 <div class="flex flex-wrap items-center justify-center gap-4 mb-4 p-3 bg-blue-50 rounded-lg">
                   
                    <label for="seat-cols" class="font-medium">排數(直):</label>
                    <input type="number" id="seat-cols" class="w-20 p-2 border rounded-md" min="1" max="20" value="7">
 		    <label for="seat-rows" class="font-medium">列數(橫):</label>
                    <input type="number" id="seat-rows" class="w-20 p-2 border rounded-md" min="1" max="20" value="6">
                    <button id="generate-seat-grid-btn" class="px-4 py-2 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition">產生座位表</button>
                    <button id="reset-seating-chart-btn" class="px-4 py-2 bg-rose-500 text-white font-semibold rounded-lg hover:bg-rose-600 transition">重新排座位</button>
                 </div>
                 <!-- Teacher's Desk -->
                 <div class="flex justify-center mb-4">
                    <div class="w-1/3 py-2 bg-blue-800 text-white text-center rounded-md font-semibold shadow">講桌</div>
                 </div>
                 <!-- Column Headers -->
                 <div id="classroom-grid-cols-header" class="grid gap-1 mb-2" style="grid-template-columns: repeat(7, 1fr);">
                    <!-- Column headers (e.g., 第 1 排) will be injected here -->
                 </div>
                 <!-- Seating Grid -->
                 <div id="classroom-grid" class="grid gap-1" style="grid-template-columns: repeat(7, 1fr);">
                    <!-- Seats will be dynamically inserted here -->
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="data-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden z-20 items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6">
            <h3 class="text-xl font-semibold mb-4">新增班級與學生名單</h3>
            <div class="space-y-4">
                <div>
                    <label for="new-class-name" class="block text-sm font-medium text-gray-700 mb-1">班級名稱:</label>
                    <input type="text" id="new-class-name" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="例如: 一年甲班">
                </div>
                <div>
                    <label for="student-list-input" class="block text-sm font-medium text-gray-700 mb-1">學生名單:</label>
                    <textarea id="student-list-input" class="w-full h-40 p-3 border border-gray-300 rounded-lg resize-none text-sm font-mono" placeholder="輸入學生座號與姓名，中間用空格區分
例如：
1 王一一
2 李二二
3 張三三"></textarea>
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button id="data-modal-add-btn" class="px-4 py-2 bg-teal-600 text-white font-semibold rounded-lg hover:bg-teal-700 transition duration-150">新增班級</button>
                <button id="data-modal-close-btn" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition duration-150">取消/關閉</button>
            </div>
        </div>
    </div>

    <div id="draw-result-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden z-30 items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md p-8 text-center transform transition-all scale-95 opacity-0" id="draw-result-modal-content">
            <h3 class="text-2xl font-bold text-slate-600 mb-4">抽中的是...</h3>
            <p id="modal-winner-name" class="text-6xl font-extrabold text-sky-600 my-8 py-4 bg-sky-50 rounded-lg">
                學生姓名
            </p>
            <button id="draw-result-modal-close-btn" class="w-full px-6 py-3 bg-sky-600 text-white font-bold text-lg rounded-lg hover:bg-sky-700 transition duration-150 shadow-lg focus:outline-none focus:ring-4 focus:ring-sky-300">繼續</button>
        </div>
    </div>
    
    <div id="confirm-clear-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden z-40 items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center">
            <h3 class="text-lg font-bold text-gray-900 mb-2">確認操作</h3>
            <p class="text-sm text-gray-600 mb-6">您確定要清除所有儲存在這個瀏覽器中的班級資料嗎？這個操作無法復原。</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-clear-execute-btn" class="px-6 py-2 bg-rose-600 text-white font-semibold rounded-lg hover:bg-rose-700">確認清除</button>
                <button id="confirm-clear-cancel-btn" class="px-6 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300">取消</button>
            </div>
        </div>
    </div>
    
    <div id="confirm-action-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden z-40 items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center">
            <h3 id="confirm-title" class="text-lg font-bold text-gray-900 mb-2">確認操作</h3>
            <p id="confirm-message" class="text-sm text-gray-600 mb-6">您確定要執行此操作嗎？</p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-action-execute-btn" class="px-6 py-2 bg-rose-600 text-white font-semibold rounded-lg hover:bg-rose-700">確認</button>
                <button id="confirm-action-cancel-btn" class="px-6 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300">取消</button>
            </div>
        </div>
    </div>

    <div id="message-box" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 p-3 bg-slate-800 text-white rounded-lg shadow-xl transition-opacity duration-300 opacity-0 pointer-events-none z-30">訊息內容</div>


    <script src="app.js" defer></script>

    <footer class="text-center py-6 mt-10">
        <p class="text-sm text-slate-500">前鎮國中　數位共學社群</p>
    </footer>

</body>
</html>


